# 无人机仅在高度轴的PID控制仿真

## 反馈控制

根据我们所学匀加速直线运动知识，可以算出无人机先以最大加速度加速，再以反向的最大加速度减速，到达目标高度时，速度正好为0.

非常好，但是实际问题中，因为螺旋桨有惯性，所以加速度不能突变；同时，实际问题中可能有空气阻力和环境风的干扰，并非只受升力和重力作用。

等等影响因素使得无人机实际飞行轨迹偏离匀加速直线运动，因此我们需要一种方法根据与目标高度的误差实时更改升力大小。

通过误差(目标高度减实际高度)动态调整控制量(升力大小)的方法，称为反馈控制。

## 开关控制

如果无人机高度比目标位置低，就输出最大升力，否则升力为0.

这就是开关控制，是一种最简单的反馈控制。但是无人机有惯性，在达到目标高度后依然有向上运动的趋势，导致无人机最终的运动轨迹周期振荡。

## PID控制

PID控制，也叫比例积分微分控制。PID的各项可以拆开看。

P称作比例项，其表达式如下:

$F_p = k_p e$

其中 $F$ 为升力， $k_p$ 为比例系数， $e$ 为误差，等于目标高度减实际高度，$e$是时间的函数。

其类似于弹簧的弹力公式：

$F = -k x$

因此无人机会以平衡位置(因为存在重力，所以平衡位置在目标高度之下)为中心做简谐运动(不考虑空气阻力)。

D称为微分项，其表达式如下：

$F_p = k_p \frac{de}{dt}$

$k_p$为微分系数，$\frac{de}{dt}$为误差对时间的导数。

其类似于阻力公式：

$f = k v$

因此微分项起阻尼作用，用来抑制振荡。

比例微分控制可以应用于绝大多数场景，例如小车寻线。

但是无人机控制当中，有重力作用。用弹簧类比，其平衡位置较目标高度偏下，使得PD控制的无人机维持在目标高度之下，因此需要对重力进行补偿。

在重力恒定的情况下，你可以将控制量加上重力进行补偿。如果重力不恒定(挂载货物)，那么就需要使用积分控制。

I称为积分项，其表达式如下：

$F_i = k_i \int_{0}^{t} e dt$

其中$k_i$是积分系数，$t$是当前时刻，$\int_{0}^{t} e dt$是误差从0到t时刻的积分。

随时间增长，积分项会越来越大，直到无人机到达平衡位置。

因此PID控制器中控制量$u$与误差$e$的关系可表示为：

$u = k_p e + k_i \int_{0}^{t} e dt + k_p \frac{de}{dt}$

其中控制量$u$和误差$e$都是时间$t$的函数

在计算机计算过程中，可以用数值方法算出其近似解。

要算出其数值解，需要将方程改为差分形式，即将时间分解为足够小的时间片$\Delta t$

方程可改写为：

$u = k_p e + k_i \sum_{0}^{t} e \Delta t + k_p \frac{e(t) - e(t-\Delta t)}{\Delta t}$

使用计算机迭代计算该方程即可进行PID控制。

## 无人机的受力分析

无人机受升力、重力、空气阻力和风力。

重力为$G = -m g$(竖直向上为正)

空气阻力为$f = -k v$

风力在模拟中是随时间连续变化的扰动力。

你可以修改这些力的各种参数，观察无人机运动有何变化。

## 小小练习

1. 更改无人机的质量、升力上下限为其他常数，调整PID，使其快速到达目标高度
2. 无人机初始质量为5kg，从地面静止起飞，飞到10m后丢下1kg物品，降落到5m台板上。改写无人机质量，目标高度函数，调节PID，使无人机能更快完成任务。