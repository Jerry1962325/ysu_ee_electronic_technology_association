## N体运动模拟实验

在著名科幻小说《三体》中，三体文明的行星位于三颗恒星的恒星系中，其运动不可预测，使得三体文明的生存条件极为恶劣。

三体问题指的是三颗天体（看作质点）在仅受万有引力作用下的运动。三体问题没有解析解，但是可以使用计算机模拟，随时间增长，计算机模拟结果会与实际结果偏差越来越大，直到运动完全不同。更进一步说，三体运动是混沌的，极小的干扰就可能彻底改变其运动状态。

## Hello World!

运行`run.sh`，看到屏幕上运动的点了吗？那是N体人的星球。恭喜你创造了一个存在一分钟的小宇宙。

多次运行模拟程序，看看能不能找出几种N体运动的特征。

## 天体运行的规律

在天体质量差不多时：

恒纪元：两个星球互相绕转；

乱纪元：可能因为第三个星球的接近，打破了两个星球的稳定绕转；

在两个星球的距离足够近时，会碰撞合成为一个星球，新星球的质量等于原来两个星球质量之和。

在天体质量差距较大时：

稳定的恒星系：恭喜，你的运气真好，出现稳定恒星系的条件比较苛刻。一般来说，恒星质量远大于行星，行星依据开普勒定律绕恒星旋转。如果你的运气极好，可以看到类似日地月的恒星行星卫星系统。

在运行时间足够长时：

稳定的恒星系出现概率较少，大部分情况要么所有星球碰撞合并为一个，要么向四周飞散。

## 万有引力的幸运儿

这是万有引力公式:

$F = G \frac{M m}{r^2}$

引力与距离的二次方成反比，这是一个我们初中就知道的结论。但如果引力与距离成正比或与距离成反比或与距离的立方成反比呢？

那么另一个世界的万有引力公式就会是像这样的：

$F = G M m r$

或

$F = G \frac{M m}{r}$

或

$F = G \frac{M m}{r^3}$

或

$F = G \frac{M m}{r^d}$(d是任意整数)

在模拟世界中，这是完全可以实现的，快去试试吧。

在万有引力公式不同的世界中，天体的运动会呈现什么规律呢？

如果万有引力与距离成正比(d=-1)，天体就像被绑上弹簧一样周期性做往复运动；

如果万有引力与距离成反比(d=1)，似乎所有天体都围绕一个中心旋转，没有向四周飞散而不回来的天体；

如果万有引力与距离的立方成反比(d=3)，天体要么向四周飞散，要么接近并合并为一个。

最后你会发现一个惊人的事实，既有天体四处飞散，也有天体稳定绕转的宇宙，只能是我们的宇宙。这个万有引力与距离的平方成反比的宇宙！

想想我们生活的太阳系，地球绕太阳转，月球绕地球转，如果d<2，那么太阳地球月球都得绕世界中心转了，如果d>2，那么地球要么飞出太阳系开启流浪，要么坠入太阳。

更进一步说，生命只能诞生在 $F = G \frac{M m}{r^2}$ 的宇宙中(如果这个宇宙有万有引力的话)。

## 小小练习

1. 修改代码，使系统出现稳定恒星系的概率增加

    可以搜索日地月的质量、距离和速度，按照实际的万有引力常数(默认的万有引力常数为1)进行模拟，如果数量级超出双精度浮点数的表示范围，可以等比例缩放。
    
    或者将一个天体的质量增大，其他天体的质量不变，多运行几次模拟，质量大的天体很可能成为恒星，质量小的天体很可能成为行星。
2. 在网上找一个三体运动的特解并模拟

    最简单的三体运动的特解是三个等质量天体共圆，三个天体互相间隔120度，沿同一方向以同一角速度绕圆心做匀速圆周运动。

    因为模拟有一定误差，理论上稳定的特解在模拟中可能不稳定，可以减小时间步长来减小误差。
3. 按上文所述更改万有引力公式，查看模拟现象

    万有引力的向量形式在程序里写成：

```C
// F_sum += gravitation = G * M * m / |r|^3 * r
// r为从star_i指向star_j的向量
r = vsub(sj->p, si->p);
l = len(r);
F = fvmul(e->G * si->m * sj->m / (l * l * l), r);
```

## 参考文献

[三体问题 https://zh.wikipedia.org/wiki/%E4%B8%89%E4%BD%93%E9%97%AE%E9%A2%98](https://zh.wikipedia.org/wiki/%E4%B8%89%E4%BD%93%E9%97%AE%E9%A2%98)

[知乎 如果万有引力和距离的三次方成反比，那么行星的轨道会是什么样的？](https://www.zhihu.com/question/26941982)

[知乎 如果万有引力不是与距离平方成反比，而是与距离成正比，会发生什么？](https://www.zhihu.com/question/338592251)