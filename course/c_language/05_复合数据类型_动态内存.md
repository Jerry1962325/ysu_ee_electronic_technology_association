## 复合数据类型

### N维数组

数组元素的类型可以是数组，例如`unsigned char img_gray[1920][1080];`就声明了一个长度为1920，类型为 "字符类型，长度1080的数组" 的数组，嵌套了一层的数组被称为二维数组

其中

`img_gray`的类型为`unsigned char[1920][1080]`

`img_gray[0]`的类型为`unsigned char[1080]`

`img_gray[0][0]`的类型为`unsigned char`

多维数组常用于图像处理领域，灰度图像的类型常为`char[图像高][图像宽]`，彩色图像的类型常为`char[图像高][图像宽][3]`，其中的3代表红绿蓝通道

可以通过嵌套for循环遍历图像的每个像素

以下是一个将灰度图像以一个阈值为分隔转化为黑白图像的算法

```C
#include <stdio.h>

#define BLACK ((unsigned char)0x00)
#define WHITE ((unsigned char)0xFF)

#define HEIGHT 20
#define WIDTH 30

void binary(unsigned char *img, int height, int width, unsigned char threshold)
{
    for (int i = 0; i < height; i++)
    {
        for (int j = 0; j < width; j++)
        {
            unsigned char *pixel = &img[i * width + j];
            if (*pixel < threshold)
            {
                *pixel = BLACK;
            }
            else
            {
                *pixel = WHITE;
            }
        }
    }
}

void char_display(const unsigned char *const img, int height, int width)
{
    for (int i = 0; i < height; i++)
    {
        for (int j = 0; j < width; j++)
        {
            printf("%c", " `:^%$#@"[img[i * width + j] / 32]);
            printf("%c", " `:^%$#@"[img[i * width + j] / 32]);
        }
        printf("\n");
    }
}

int main()
{
    unsigned char img[HEIGHT][WIDTH];

    // 随意地初始化
    for (int i = 0; i < HEIGHT; i++)
    {
        for (int j = 0; j < WIDTH; j++)
        {
            img[i][j] = ((i - HEIGHT / 2) * (i - HEIGHT / 2) + (j - WIDTH / 2) * (j - WIDTH / 2)) % 256;
        }
    }

    char_display((unsigned char *)&img, HEIGHT, WIDTH);

    // 以128为阈值二值化
    binary((unsigned char *)&img, HEIGHT, WIDTH, 128);

    char_display((unsigned char *)&img, HEIGHT, WIDTH);

    return 0;
}
```

### 枚举体

`typedef`是定义类型别名的关键字，语法如下

```C
typedef unsigned char u8;
```

这就是将定义 u8 为 无符号字符型 的别名

后面定义复合数据类型时会经常用到`typedef`

枚举体可以为一组常量取名，方便阅读

例如使用枚举体存储星期

```C
#include <stdio.h>

typedef enum
{
    Mon = 1,
    Tue,
    Wed,
    Thu,
    Fri,
    Sat,
    Sun
} Week;

char *week2str(Week week)
{
    char *week_strings[] = {NULL, "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"};
    return week_strings[week];
}

int main()
{
    Week w = Mon;
    printf("Today is %s\n", week2str(w));
    return 0;
}
```

### 结构体

结构体是用来存储不同数据类型的复合数据类型

例如想保存学生的信息，可以定义结构体

```C
typedef enum
{
    Male,
    Female,
} Gender;

typedef struct
{
    char *name;
    unsigned long long stu_number;
    Gender gender; // 使用枚举体表示性别可以兼容美国国情
    unsigned char age;
} Student;
```

上面的代码定义了`Student`结构体，`name`、`stu_number`等称为结构体的成员变量

结构体的成员变量在内存中相邻存储，同时进行内存对齐

下面是一个计算科协男女比的代码

```C
#include <stdio.h>
#include <math.h>

typedef enum
{
    Male,
    Female,
} Gender;

typedef struct
{
    char *name;
    unsigned long long stu_number;
    Gender gender; // 使用枚举体表示性别可以兼容美国国情
    unsigned char age;
} Student;

int main()
{
    Student sci_club_students[4] = {
        {"张三", 12345, Male, 19},
        {"李四", 9876, Female, 20},
        {"王五", 876567, Male, 21},
        {"刘六", 32123, Female, 18},
    };

    int male_counter = 0;
    int female_conuter = 0;
    for (int i = 0; i < 4; i++)
    {
        switch (sci_club_students[i].gender)
        {
        case Male:
            male_counter++;
            break;
        case Female:
            female_conuter++;
            break;
        }
    }

    printf("科协的男女比为: %.2f\n", (float)male_counter / (float)female_conuter);
    return 0;
}
```

在这段代码中定义了`sci_club_students`这个结构体数组来存放科协的学生信息

`sci_club_students`的类型为`Student []`

`sci_club_students[i]`的类型为`Student`

`sci_club_students[i].gender`的类型为枚举体`Gender`

使用`.`点运算符即可取出结构体的成员变量

可以使用函数来处理结构体，以下定义了一个计算科协男女比的函数

```C
// 略

float male_female_ratio(Student *students, int n)
{
    int male_counter = 0;
    int female_conuter = 0;
    for (int i = 0; i < n; i++)
    {
        switch (students[i].gender)
        {
        case Male:
            male_counter++;
            break;
        case Female:
            female_conuter++;
            break;
        }
    }
    return (float)male_counter / (float)female_conuter;
}

int main()
{
    Student sci_club_students[4] = {
        {"张三", 12345, Male, 19},
        {"李四", 9876, Female, 20},
        {"王五", 876567, Male, 21},
        {"刘六", 32123, Female, 18},
    };

    printf(
        "科协的男女比为: %.2f\n",
        male_female_ratio((Student *)sci_club_students, 4));
    return 0;
}
```

使用箭头运算符`->`可以操作结构体指针

例如:

```C
// 略

void age_plus_one(Student *stu)
{
    stu->age++;
}

int main()
{
    Student xiao_ming = {"小明", 123456, Male, 12};

    printf("小明的年龄为: %d\n", xiao_ming.age);

    printf("Happy Birthday!\n");

    age_plus_one(&xiao_ming);

    printf("小明的年龄为: %d\n", xiao_ming.age);
    return 0;
}
```

其中`stu->age`等同于`(*stu).age`

### 函数指针

## 动态内存

### 堆和栈

### malloc和free

### 实现动态数组